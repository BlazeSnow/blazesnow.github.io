---
lastUpdated: 2025-02-13T11:18:00+8:00
---

# 前言 | DNS加密

## 什么是DNS？

域名系统（英语：Domain Name System，缩写：DNS）是互联网的一项服务。它作为将域名和IP地址相互映射的一个分布式数据库，能够使人更方便地访问互联网。DNS使用TCP和UDP端口53。当前，对于每一级域名长度的限制是63个字符，域名总长度则不能超过253个字符。

## 为什么要加密DNS？

传统的DNS查询和响应以明文形式在网络中传输，这使得黑客和恶意第三方可以轻易地拦截和篡改这些信息，实施DNS劫持，将用户重定向到假冒网站或植入恶意软件。加密DNS通过对查询和响应进行加密，确保数据在传输过程中不被窃听或篡改，有效抵御此类攻击。

## DNS的传输协议

### DNS over UDP/TCP/53 （Do53）

从 1983 年起源到最近，DNS 主要回答 UDP 端口 53 上的查询。此类查询包括从客户端以单个 UDP 数据包发送的明文请求，响应为 从服务器以单个 UDP 数据包发送的明文回复。 当应答的长度超过 512 字节并且客户端和服务器都支持 DNS 扩展机制 (EDNS) 时，可能会使用更大的 UDP 数据包。 DNS-over-UDP 的使用受到限制，其中包括缺乏传输层加密、身份验证、可靠传递和消息长度。 1989 年，RFC 1123 为 DNS 查询、回复，特别是区域传输指定了可选的 TCP 传输。 通过长响应的分段，TCP 允许更长的响应、可靠的传递和重用客户端和服务器之间的长期连接。

### DNS over TLS（DoT）

加密 DNS 的 IETF 标准于 2016 年出现，利用传输层安全（TLS）来保护整个连接，而不仅仅是 DNS 有效负载。DoT 服务器侦听 TCP 端口 853。RFC 7858 指定可以支持机会加密和认证加密，但没有强制服务器或客户端认证。

### DNS over QUIC（DoQ）

互联网工程任务组的 RFC 9250 描述了 DNS over QUIC。

### DNS over HTTPS（DoH）

2018 年引入了 DNS 查询传输的竞争标准，通过 HTTPS 隧道传输 DNS 查询数据（进而通过 TLS 传输 HTTP）。DoH 被推广为对网络更友好的 DNS 替代方案，因为与 DNSCrypt 一样，它在 TCP 端口 443 上传输，因此看起来类似于网络流量，尽管它们在实践中很容易区分。 DoH 因相对于 DoT 降低用户匿名性而受到广泛批评。

### Oblivious DNS 和 Oblivious DoH

Oblivious DNS （ODNS）是由普林斯顿大学和芝加哥大学的研究人员发明和实施的，作为未加密 DNS 的扩展，在 DoH 本身被标准化和广泛部署之前。Apple 和 Cloudflare 随后将该技术部署在 DoH 环境中，称为 Oblivious DoH （ODoH）。ODoH 将入口/出口分离（在 ODNS 中发明）与 DoH 的 HTTPS 隧道和 TLS 传输层加密结合在一个协议中。

### DNS over Tor

与其他 Internet 协议一样，DNS 可以通过 VPN 和隧道运行。 DNS-over-Tor 自 2019 年以来已经变得足够普遍以保证其自己经常使用的首字母缩略词的一种用途。Oblivious DNS 的隐私效果可以通过使用预先存在的入口和出口节点的 Tor 网络以及 TLS 提供的传输层加密来获得。

### DNSCrypt

DNSCrypt协议于 2011 年在 IETF 标准框架之外开发，在递归解析器的下游侧引入了 DNS 加密，其中客户端使用服务器的公钥加密查询有效负载，这些公钥在 DNS 中发布（而不是依赖于第三方方证书颁发机构），进而可能受到 DNSSEC 签名的保护。DNSCrypt 使用 TCP 或 UDP 端口 443，与 HTTPS 加密的网络流量相同的端口。这不仅引入了关于查询内容的隐私，而且还引入了防火墙穿越能力的重要衡量标准。在 2019 年，DNSCrypt 进一步扩展以支持“匿名”模式，类似于提议的“Oblivious DNS”，其中入口节点接收已使用不同服务器的公钥加密的查询，并将其转发给该服务器服务器充当出口节点，执行递归解析。创建用户/查询对的隐私，因为入口节点不知道查询的内容，而出口节点不知道客户端的身份。 DNSCrypt 于 2011 年 12 月由 OpenDNS 首次在生产环境中实现。有几个免费和开源软件实现额外集成了 ODoH。它适用于各种操作系统，包括 Unix、Apple iOS、Linux、Android 和 MS Windows。
